version: '3.9'
services:
  app:
    # for M1 processors
    platform: linux/arm64/v8
    container_name: app
    # –∏—â–µ—Ç —ç—Ç–æ—Ç image, –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π –æ–±—Ä–∞–∑–∞
    image: app
    build:
      # üÄÑ –∫–æ–Ω—Ç–µ–∫—Å—Ç (–ø–∞–ø–∫–∞ –∏–∑ –∫–æ—Ç–æ—Ä–æ–π —Å—á–∏—Ç–∞–µ—Ç—Å—è –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω Dockerfile)
      context: ..
      # üìÇ —É–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ Dockerfile (—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ –≤ —Å–ª—É—á–∞–µ –µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è)
      dockerfile: ./dockerfiles/Dockerfile
    environment:
      # –¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∏–º–µ–º–Ω–∞ —Ö–æ—Å—Ç–∞ –≤ —Å–µ—Ç–∏ –¥–æ–∫–µ—Ä–∞ —É–∫–∞–∑–∞–Ω–æ –≤ Networks > Aliases (docker inspect postgres-service_db)
      SQLALCHEMY_DATABASE_URI: postgresql://user:password@service_db:5432/db_name
    # CONFIG_NAME: config # ???
    volumes:
      # —Ç–æ–º –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º (–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)
      # docker compose restart <service> –ø–æ–¥–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑–æ–π
      - ../app:/code/app
    ports:
      - 5000:5000
    # üöÄ –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç CMD –≤ Dockerfile)
    command: "app"
    depends_on:
      - service_db

  service_db:  # –∏–º—è —Ö–æ—Å—Ç–∞ (–∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ –ª–æ–∫–ª—å–Ω–æ–π —Å–µ—Ç–∏)
    platform: linux/arm64/v8
    container_name: postgres-service_db # –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    image: postgres:12 # –æ–±—Ä–∞–∑, –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–±—Ä–∞–Ω
    environment: # –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –ø–æ —Å—É—Ç–∏ —è–≤–ª—è—é—â–∏–µ—Å—è –∫—Ä–µ–¥–∞–º–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î
      POSTGRES_DB: db_name
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    # —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
      # PGDATA: /var/lib/postgresql/data/pgdata
      PGDATA: /var/lib/postgresql/dat2/pgdata
    volumes:
    # —Ç–æ–º —Å–≤—è–∑—ã–≤–∞—é—â–∏–π –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —É —Ö–æ—Å—Ç–∞ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
      # - ${HOME}/dbs/flask-lesson/pgdata_dev:/var/lib/postgresql/data/pgdata
      - ${HOME}/dbs/flask-lesson/pgdata_dev:/var/lib/postgresql/data2/pgdata
    ports:
      - "5432:5432" # —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ—Ä—Ç–æ–≤ –Ω–∞ —Ö–æ—Å—Ç:–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä